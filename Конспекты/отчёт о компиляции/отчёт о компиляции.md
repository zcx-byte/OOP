## Отчёт о компилировании программы в PowerShell (Обновлённый)

### Установка MinGW-w64

Чтобы компилировать C++ программы в Windows с помощью командной строки, необходимо установить компилятор `g++`. Одним из наиболее доступных и распространённых решений является **MinGW-w64** — современная версия MinGW, поддерживающая 64-битные приложения и последние стандарты языка C++. Ниже приведён пошаговый процесс установки.

#### Шаг 1: Скачивание MinGW-w64

1. Перейдите на официальный ГитХаб MinGW-w64:  
   [https://github.com/niXman/mingw-builds-binaries/releases](https://github.com/niXman/mingw-builds-binaries/releases)


2. Так же можете скачать из SourceForge:  
   [https://sourceforge.net/projects/mingw-w64/files/Toolchains%20targetting%20Win64/Personal%20Builds/mingw-builds/](https://sourceforge.net/projects/mingw-w64/files/Toolchains%20targetting%20Win64/Personal%20Builds/mingw-builds/)

   Однако тут не актуальные версии, могут быть проблемы. (На момент 07.11.2025 последняя версия на GitHub - 15.2.0-rt_v13-rev0, а на SourceForge - 14.2.0-rt_v12-rev2).

3. Выберите последнюю стабильную версию (например, `15.2.0`).

   Пример имени файла:
   ```
   x86_64-15.2.0-release-mcf-seh-ucrt-rt_v13-rev0.7z
   ```

5. Скачайте архив и распакуйте его с помощью 7-Zip или WinRAR в удобное место на диске, например:
   ```
   C:\mingw64
   ```

#### Шаг 2: Добавление пути к компилятору `g++` в переменную среды `Path` через свойства системы

После установки компилятора необходимо добавить путь к исполняемым файлам в системную переменную среды `Path`, чтобы можно было запускать `g++` из любого места в консоли.

##### Шаги:

1. Нажмите **Пуск** и введите в поиске:  
   **"переменные среды"**  
   (или "environment variables").

2. В результатах выберите:  
   **"Изменение переменных среды"** или **"Переменные среды"**.

3. Откроется окно **"Свойства системы"**.  
   Внизу окна нажмите кнопку **"Переменные среды"**.

![Свойства -> "Переменные среды"](image.png)

4. В разделе **"Системные переменные"** найдите строку **`Path`** и нажмите на неё **"Изменить"**.

![Переменные среды](image-1.png)

5. В открывшемся окне нажмите **"Добавить"** и укажите полный путь к папке `bin` внутри установленного каталога MinGW-w64:
   ```
   C:\mingw64\bin
   ```

6. Нажмите **"ОК"** во всех окнах, чтобы сохранить изменения.

7. Перезапустите PowerShell или командную строку, чтобы изменения вступили в силу.

8. Проверьте установку:

```powershell
g++ --version
```

Если команда выводит информацию о версии G++ — установка прошла успешно.

### 2. Основные команды и приёмы работы в PowerShell (и оболочке Windows в целом)

Для эффективной работы в консоли необходимо знать базовые команды. Это относится как к PowerShell, так и к Command Prompt (cmd), а также к другим оболочкам.

#### Работа с файлами и директориями:

- **`cd <путь>`** — переход в указанную директорию.  
  Пример: `cd C:\projects\quadratic`

- **`cd ..`** — переход на уровень выше.

- **`cd \`** — переход в корневую директорию текущего диска.

- **`ls`** или **`dir`** — отображение содержимого текущей папки.  
  Команда `ls` является алиасом для `Get-ChildItem` в PowerShell, `dir` — команда cmd.

- **`pwd`** или **`cd`** (без аргументов) — вывод полного пути к текущей директории.

- **`mkdir <имя_папки>`** или **`md <имя_папки>`** — создание новой директории.

- **`rm <имя_файла>`** или **`del <имя_файла>`** — удаление файла. `rm` в PowerShell, `del` в cmd.

- **`cp <источник> <назначение>`** или **`copy <источник> <назначение>`** — копирование файлов. `cp` в PowerShell, `copy` в cmd.

- **`mv <старое_имя> <новое_имя>`** или **`ren <старое_имя> <новое_имя>`** — перемещение/переименование файлов. `mv` в PowerShell, `ren` в cmd.

#### Работа с консолью (Консоль):

- **Автодополнение с помощью клавиши Tab** — при вводе части имени файла или папки нажмите `Tab`, чтобы система автоматически дополнила имя. При наличии нескольких совпадений повторное нажатие переключает варианты.

- **Стрелка вверх (↑)** — позволяет просматривать историю ранее введённых команд. Удобно для повторного запуска `g++` или программы.

- **Стрелка вниз (↓)** — позволяет просматривать историю ранее введённых команд в обратном порядке.

- **`Ctrl+C`** — прерывание выполнения текущей программы или команды.

- **`Ctrl+L`** (в PowerShell) — очистка экрана консоли (аналог `clear` в других оболочках).

- **`cls`** (в cmd и PowerShell) — очистка экрана консоли.

- **`type <имя_файла>`** (в cmd) или **`Get-Content <имя_файла>`** (в PowerShell, сокращённо `cat <имя_файла>`) — вывод содержимого текстового файла в консоль.

- **`echo <текст>`** — вывод текста на экран.

- **`more <имя_файла>`** — постраничный вывод содержимого файла.

- **`help <команда>`** (в cmd) или **`Get-Help <команда>`** (в PowerShell, сокращённо `man <команда>`) — получение справки по команде.

---

### 3. Процесс компиляции программы

Структура проекта следующая:

```
C:\projects\quadratic\
    main.cpp
    formulas.cpp
    formulas.h
```

#### Шаг 1: Переход в рабочую директорию

```powershell
cd C:\projects\quadratic
```

#### Шаг 2: Проверка содержимого папки

```powershell
ls
```

Убедитесь, что отображаются файлы `main.cpp`, `formulas.cpp`, `formulas.h`.

#### Шаг 3: Компиляция программы

Выполните команду компиляции:

```powershell
g++ main.cpp formulas.cpp -o program.exe
```

Эта команда:
- Компилирует `main.cpp` и `formulas.cpp`.
- Объединяет объектные файлы.
- Создаёт исполняемый файл `program.exe`.

Если ошибок нет, файл `program.exe` будет создан в текущей директории.

#### Шаг 4: Запуск программы

```powershell
.\program.exe
```

В Windows для запуска исполняемого файла из текущей директории требуется указывать путь `.\`, иначе система не распознает команду.

Программа запросит ввод коэффициентов `ax`, `bx^2`, `c` и выведет результат решения квадратного уравнения.

---

### 4. Оптимизация: уменьшение размера исполняемого файла (Минимизация размера)

При разработке программ, особенно для встраиваемых систем, дистрибутивов с ограниченным объёмом или просто для повышения эффективности, часто требуется уменьшить размер итогового исполняемого файла. Компилятор G++ предоставляет ряд флагов и подходов для достижения этой цели.

#### Основные флаги компиляции

```powershell
g++ -O2 -s main.cpp formulas.cpp -o program.exe
```

Разберём каждый элемент подробнее.

#### -O2 — уровень оптимизации

Флаг `-O2` включает умеренный уровень оптимизации, направленный как на повышение производительности, так и на уменьшение размера кода по сравнению с `-O0` (отсутствие оптимизации). Он активирует такие оптимизации, как:

- Удаление мёртвого кода (dead code elimination)
- Встраивание небольших функций (inlining)
- Упрощение выражений (constant folding, propagation)
- Оптимизация циклов
- Удаление избыточных вычислений

Примечание: если главная цель — минимальный размер, а не максимальная скорость, лучше использовать флаг `-Os` (optimize for size).

Пример:
```powershell
g++ -Os -s main.cpp formulas.cpp -o program.exe
```

#### -s — удаление символьной (отладочной) информации

Флаг `-s` передаёт линковщику (`ld`) опцию `--strip-all`, которая полностью удаляет из исполняемого файла:

- Таблицы символов (symbol tables)
- Отладочную информацию (debug info)
- Имена функций и переменных, не нужные для выполнения

Это может значительно уменьшить размер `.exe`-файла, особенно если в проекте много функций и глобальных переменных.

Важно: после использования `-s` вы не сможете отлаживать программу в отладчике (например, GDB), так как вся отладочная информация будет утеряна.

Альтернатива: если вы хотите сохранить отладочную информацию отдельно, можно использовать внешние инструменты:
```powershell
g++ -g -Os main.cpp formulas.cpp -o program_with_debug.exe
strip --strip-debug --strip-unneeded program_with_debug.exe -o program.exe
objcopy --only-keep-debug program_with_debug.exe program.debug
```
Таким образом, `program.exe` будет компактным, а `program.debug` — содержать отладочную информацию для последующего анализа.

#### Дополнительные флаги для минимизации размера:

- **`-ffunction-sections -fdata-sections`** — размещает каждую функцию и переменную в отдельной секции. Это позволяет линковщику (`-Wl,--gc-sections`) удалить неиспользуемые секции, что может уменьшить размер.
  ```powershell
  g++ -Os -ffunction-sections -fdata-sections -s main.cpp formulas.cpp -o program.exe -Wl,--gc-sections
  ```

- **`-flto` (Link Time Optimization)** — может улучшить оптимизацию и уменьшить размер, но увеличивает время компиляции.
  ```powershell
  g++ -Os -flto -s main.cpp formulas.cpp -o program.exe
  ```

- **`-static-libgcc -static-libstdc++`** — статически линкует стандартные библиотеки GCC и C++. Это делает исполняемый файл больше, но *независимым* от наличия этих библиотек в системе пользователя. Если размер критичен и вы готовы, чтобы пользователь установил нужные библиотеки (например, MinGW-w64 runtime), *не используйте* эти флаги. Если важна *портативность*, можно их применить, но учитывайте увеличение размера.

---

### 5. Статические библиотеки

Статическая библиотека — это файл, содержащий **скомпилированный код**, который можно **встроить в исполняемый файл** во время сборки. В Windows такие библиотеки имеют расширение `.lib`, в Linux — `.a`.

#### Зачем они нужны?

- Ускоряют сборку проектов.
- Позволяют **разделять код** на модули.
- Упрощают **повторное использование** компонентов.

---

#### Создание статической библиотеки из `formulas.cpp`

Статическая библиотека — это архив объектных файлов, который встраивается непосредственно в исполняемый файл на этапе линковки. Это позволяет распространять программу как единый файл без дополнительных зависимостей.

##### Шаг 1: Компиляция `formulas.cpp` в объектный файл

```powershell
g++ -c formulas.cpp -o formulas.o
```

Флаг `-c` указывает компилятору остановиться после этапа компиляции и не выполнять линковку. В результате создаётся объектный файл `formulas.o`, содержащий машинный код функций из `formulas.cpp`, но без разрешения внешних ссылок.

##### Шаг 2: Создание статической библиотеки

```powershell
ar rcs libformulas.a formulas.o
```

- `ar` — утилита для работы с архивами (в данном контексте — со статическими библиотеками).
- Флаги:
  - `r` — заменить или добавить файлы в архив.
  - `c` — создать архив, если он не существует (без предупреждения).
  - `s` — создать индекс (таблицу символов), что ускоряет последующую линковку.
- `libformulas.a` — стандартное имя статической библиотеки в Unix-подобных системах и MinGW. Префикс `lib` и расширение `.a` обязательны для корректной работы с флагом `-l`.

##### Шаг 3: Компиляция и линковка с библиотекой

```powershell
g++ main.cpp -L. -lformulas -o program.exe
```

- `-L.` — указывает линковщику искать библиотеки в текущем каталоге (`.`).
- `-lformulas` — указывает использовать библиотеку с именем `libformulas.a`. Компилятор автоматически добавляет префикс `lib` и расширение `.a`.
- В результате код из `formulas.o` будет включён непосредственно в `program.exe`.

> Примечание: если в `main.cpp` используются функции из `formulas.cpp`, необходимо, чтобы соответствующие объявления (заголовочные файлы, например `formulas.h`) были доступны на этапе компиляции. В противном случае возникнет ошибка «undefined reference» или «implicit declaration».

##### Дополнительные рекомендации

- **Заголовочный файл**: рекомендуется создать файл `formulas.h`, содержащий объявления всех функций из `formulas.cpp`, и включать его в `main.cpp` с помощью `#include "formulas.h"`. Это обеспечивает корректную проверку типов и сигнатур функций.

- **Оптимизация при создании библиотеки**: для уменьшения итогового размера можно скомпилировать объектный файл с флагами оптимизации:
  ```powershell
  g++ -Os -c formulas.cpp -o formulas.o
  ```

- **Проверка содержимого библиотеки**: чтобы убедиться, что библиотека содержит нужные символы, можно использовать:
  ```powershell
  nm libformulas.a
  ```
  Эта команда покажет список всех символов (функций, переменных) в архиве.

- **Порядок линковки**: при использовании нескольких библиотек порядок их указания в команде линковки может иметь значение. Библиотеки, зависящие от других, следует указывать **после** тех, от которых они зависят.

---

### 6. Использование Visual Studio Code (IDE)

Visual Studio Code (VS Code) — это лёгкий, но мощный текстовый редактор с открытым исходным кодом от Microsoft, который можно превратить в полнофункциональную среду разработки (IDE) для C++ с помощью расширений. Он отличается от полнофункциональной Visual Studio тем, что изначально предоставляет минимальный набор функций, расширяемый через плагины, и требует ручной настройки процесса сборки и отладки.

#### Установка и настройка

1. **Установка VS Code**  
   Скачайте и установите VS Code с официального сайта: [https://code.visualstudio.com/](https://code.visualstudio.com/)

2. **Установка расширения для C++**  
   После запуска VS Code откройте палитру команд (`Ctrl+Shift+P`) и введите `Extensions: Install Extensions`. Найдите и установите официальное расширение **C/C++** от Microsoft.

3. **Установка отладчика (если ещё не установлен)**  
   Обычно расширение C/C++ устанавливает отладчик (например, `gdb` для MinGW-w64) автоматически, если он обнаруживается в системе (проверьте, что `g++.exe` и `gdb.exe` доступны через переменную `PATH`, как описано в разделе 1).

4. **Создание проекта**  
   Откройте папку с вашим проектом (например, `C:\projects\quadratic`) через `File -> Open Folder`.

5. **Добавление файлов**  
   Файлы (`main.cpp`, `formulas.cpp`, `formulas.h`, `quadratic_tests.cpp`) должны отображаться в проводнике слева. Просто добавьте их в папку проекта.

6. **Компиляция и запуск**  
   VS Code не компилирует код автоматически. Компиляцию нужно выполнять вручную через встроенную в редактор консоль (Terminal -> New Terminal) или внешнюю командную строку, используя команды, описанные в разделе 3.  
   ```powershell
   g++ main.cpp formulas.cpp -o program.exe
   .\program.exe
   ```
   Также можно настроить задачи (`Tasks`) в VS Code для выполнения этих команд через меню `Terminal -> Run Task`.

#### Преимущества использования Visual Studio Code

- **Лёгкий и быстрый**: Запускается и работает быстрее, чем полнофункциональная IDE.
- **Высокая настраиваемость**: Плагины позволяют адаптировать редактор под любые нужды.
- **Отличная поддержка Git**: Встроенный интерфейс для Git.
- **Интеграция с терминалом**: Встроенный терминал для выполнения команд компиляции и отладки.
- **IntelliSense**: Подсветка синтаксиса, автодополнение, переход к определениям (требует правильной настройки `c_cpp_properties.json`).
- **Работа с разными компиляторами**: Легко настраивается под MinGW-w64, Clang, MSVC и другие.

#### Дополнительные возможности

- **Файлы настроек**: `.vscode/settings.json`, `.vscode/c_cpp_properties.json`, `.vscode/tasks.json`, `.vscode/launch.json` позволяют настроить поведение редактора, пути к заголовкам, задачи сборки и отладки.
- **Работа с несколькими компиляторами**: Можно легко переключаться между разными установленными компиляторами.
- **Расширения**: Существует множество расширений для линтов (например, `cpplint`, `clang-format`), работы с тестами и т.д.

---

### 7. Использование Git для управления проектом

Git — система контроля версий, позволяющая отслеживать изменения в коде и работать в команде.

#### Инициализация репозитория:

```powershell
git init
git add .
git commit -m "Initial commit: quadratic calculator with formulas module"
```

#### Пример `.gitignore`:

```
# Executables
*.exe
*.out

# Build directories
build/

# Logs
*.log

# VS Code settings
.vscode/
```

---

### Заключение

В ходе работы была настроена среда для разработки на C++ в Windows: установлен компилятор MinGW-w64, настроены переменные среды и освоены основные команды PowerShell. Программа для решения квадратных уравнений была успешно скомпилирована через командную строку.

Рассмотрены ключевые аспекты сборки:
- Базовая компиляция нескольких исходных файлов
- Оптимизация размера исполняемого файла с помощью флагов `-Os`, `-s`, `-ffunction-sections`, `-fdata-sections`, `-Wl,--gc-sections` и других (Минимизация размера)
- Создание и использование статических библиотек
- Альтернативные подходы к разработке через редактор VS Code (IDE)
- Основные команды работы с файлами и консолью (Консоль)

Освоение этих методов позволяет эффективно работать над проектами любой сложности, выбирая оптимальный способ сборки и разработки в зависимости от требований к размеру программы, производительности и удобству разработки.